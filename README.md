# `surveilr` Resource Surveillance

This Rust-based project is an extendable file system inspector for performing
surveillance of machine resources. It is used to walk resources like file
systems and generate an SQLite database which can then be consumed by any
computing environment that supports SQLite.

**IMPORTANT**: Use SQLa to generate all SQL so it's portable but use SeaORM to
make working with database entities more ergonomic. Remember to only use an ORM
to help improve developer productivity, always assume SQLite database will be
used across polyglot programming environments so SQL code should be transparent
and portable.

## Usage

Development prerequisites:

- Install Rust toolchain (1.73 or above, best to use `rustup`, `asdf` or `rtx`
  for multiple simultaneous versions)
- `cargo install just` so we can use `Justfile` for task management

Regular use:

```bash
$ just --completions fish | source            # setup completions to reduce typing

$ just test                                   # run unit tests with cargo nextest

$ just run                                    # get CLI help
$ cargo run -- --help                         # get CLI help, same as above

$ just run help-markdown                      # get CLI in Markdown and update this README.md manually
$ cargo run -- --help-markdown > CLI-help.md  # get CLI in Markdown, same as above

$ just run fs-walk --help                     # get CLI help for fs-walk subcommand
$ just run fs-walk                            # walk the current working directory (CWD)
$ just run fs-walk -r /other -r /other2       # walk some other director(ies)
$ just run fs-walk -i .git/                   # walk CWD, ignore .git/ paths
$ just run fs-walk -i .git/ -i target/        # walk CWD, ignore .git/ and target/ paths

$ just sqla-sync                              # generate SQLa bootstrap and other SQL
                                             
$ just dev                                    # turn on auto-compile, auto-run during development
                                              # using cargo-watch command
```

## Command-Line Help for `surveilr`

This document contains the help content for the `surveilr` command-line program
and is autogenerated by running `--help-markdown`.

**Command Overview:**

- [`surveilr` Resource Surveillance](#surveilr-resource-surveillance)
  - [Usage](#usage)
  - [Command-Line Help for `surveilr`](#command-line-help-for-surveilr)
  - [`surveilr`](#surveilr)
          - [**Subcommands:**](#subcommands)
          - [**Options:**](#options)
  - [`surveilr fs-walk`](#surveilr-fs-walk)
          - [**Options:**](#options-1)

## `surveilr`

**Usage:** `surveilr [OPTIONS] [COMMAND]`

###### **Subcommands:**

- `fs-walk` — Walks the device file system

###### **Options:**

- `--help-markdown` — Generate a Markdown file of all CLI commands and options
- `--device-name <DEVICE_NAME>` — How to identify this device

  Default value: `hostname()`
- `-c`, `--config <FILE>` — TODO: Use a Deno *.ts or Nickel config file for
  defaults, allowing CLI args as overrides
- `-d`, `--debug` — TODO: Turn debugging information on

## `surveilr fs-walk`

Walks the device file system

**Usage:** `surveilr fs-walk [OPTIONS]`

###### **Options:**

- `-r`, `--root-path <ROOT_PATH>` — one or more root paths to walk

  Default value: `.`
- `-i`, `--ignore-entry <IGNORE_ENTRY>` — reg-exes to use to ignore files in
  root-path(s)

  Default value: `/(\.git|node_modules)/`
- `--compute-digests <COMPUTE_DIGESTS>` — reg-exes to use to compute digests for

  Default value: `.*`
- `--surveil-content <SURVEIL_CONTENT>` — reg-exes to use to load content for
  entry instead of just walking

  Default value: `\.(md|mdx|html|json)$`
- `--surveil-db-url <SURVEIL_DB_URL>` — reg-exes to use to load frontmatter for
  entry in addition to content

  Default value: `sqlite://device-surveillance.sqlite.db`
